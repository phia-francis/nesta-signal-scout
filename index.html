<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nesta Signal Scout Pro</title>
    
    <script>
        const originalWarn = console.warn;
        console.warn = (...args) => {
            if (args[0] && typeof args[0] === 'string' && args[0].includes('cdn.tailwindcss.com')) return;
            originalWarn.apply(console, args);
        };
    </script>

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/10.0.2/standalone/umd/vis-network.min.js" integrity="sha512-9YVQZyV2hlSqEXZDwSEVia7u4T+qBkLE7KYG24LalL3J1zoQJXAiWpobprig/vGhV1VCfPIxF4EvHDYCSrSpmw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.3/jspdf.umd.min.js" integrity="sha512-+EeCylkt9WHJk5tGJxYdecHOcXFRME7qnbsfeMsdQL6NUPYm2+uGFmyleEqsmVoap/f3dN/sc3BX9t9kHXkHHg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="./static/css/styles.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        nesta: {
                            blue: '#0000FF',        
                            navy: '#0F294A',        
                            pink: '#F6A4B7',        
                            yellow: '#FDB633',      
                            green: '#18A48C',       
                            aqua: '#97D9E3',        
                            purple: '#9A1BBE',      
                            orange: '#FF6E47',      
                            red: '#EB003B',         
                            sand: '#D2C9C0',        
                            darkgrey: '#646363',    
                            black: '#000000',       
                            white: '#FFFFFF'        
                        }
                    },
                    fontFamily: {
                        display: ['"Zosia Display"', 'sans-serif'],
                        body: ['"Averta"', 'sans-serif']
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'radar-spin': 'spin 2s linear infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(15px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        pop: {
                            '0%': { transform: 'scale(0.95)' },
                            '100%': { transform: 'scale(1)' }
                        },
                        pulse: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.6' }
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(15, 41, 74, 0.08)',
                        'hover': '0 10px 30px -5px rgba(0, 0, 255, 0.15)',
                        'glow': '0 0 15px rgba(151, 217, 227, 0.3)',
                    }
                }
            }
        }
    </script>

    <style>
        
        body { font-family: 'Averta', sans-serif; background-color: #F9FAFB; color: #0F294A; }
        h1, h2, h3, .brand-font { font-family: 'Zosia Display', sans-serif; }

        /* UTILITIES */
        .glass-panel { background: rgba(255, 255, 255, 0.98); border: 1px solid rgba(15, 41, 74, 0.05); }
        .card-hover { transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 12px 30px -8px rgba(0, 0, 255, 0.12); }
        
        /* HIGHLIGHT FOR RADAR CLICK */
        .card-highlight {
            border-color: #0000FF !important;
            box-shadow: 0 0 0 4px rgba(0, 0, 255, 0.2) !important;
            transform: scale(1.02);
        }
        
        /* CUSTOM RANGE SLIDER */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%;
            background: #0000FF; cursor: pointer; margin-top: -7px; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.15); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #97D9E3; border-radius: 2px;
        }

        /* RADAR LOADER */
        .radar-loader {
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* --- BUTTON ANIMATIONS & INTERACTIVITY --- */
        
        /* Filter Chips (Purple) */
        .bias-chip label {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }
        .bias-chip label:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(15, 41, 74, 0.1);
            border-color: #9A1BBE;
        }
        .bias-chip label:active { transform: scale(0.95); }
        .bias-chip input:checked + label {
            background-color: #9A1BBE; 
            color: #FFFFFF; 
            border-color: #9A1BBE; 
            box-shadow: 0 4px 12px rgba(154, 27, 190, 0.3);
            animation: pulse-purple 0.4s ease-out;
        }

        /* Hard Tech Toggle (Orange) */
        .tech-toggle-label { transition: all 0.2s ease; }
        .tech-toggle-group:hover .tech-toggle-label { color: #FF6E47; }
        .tech-toggle-group:active { transform: scale(0.98); }

        /* CTA Buttons */
        .btn-interactive { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-interactive:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .btn-interactive:active { transform: translateY(0); transform: scale(0.97); }

        /* Radar Filters */
        .filter-view-btn { transition: all 0.2s ease; }
        .filter-view-btn.active { background-color: #0F294A; color: white; border-color: #0F294A; }

        /* Fix Dropdown Arrows */
        select.appearance-none {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: none;
            background-color: transparent;
        }
        select::-ms-expand { display: none; }

        .tooltip {
            position: relative;
        }
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            bottom: calc(100% + 8px);
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            font-family: 'Averta', sans-serif;
            font-size: 11px;
            line-height: 1.4;
            padding: 6px 10px;
            border-radius: 6px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 50;
        }
        .tooltip:hover::after {
            opacity: 1;
        }

        @keyframes pulse-purple {
            0% { box-shadow: 0 0 0 0 rgba(154, 27, 190, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(154, 27, 190, 0); }
            100% { box-shadow: 0 0 0 0 rgba(154, 27, 190, 0); }
        }
        
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="min-h-screen flex flex-col antialiased bg-gray-50" onload="initDashboard()">

    <header class="bg-nesta-navy text-white sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white text-nesta-navy flex items-center justify-center text-xl font-bold rounded-sm brand-font shadow-md">N</div>
                <div class="flex flex-col">
                    <h1 class="text-2xl leading-none tracking-tight">Signal Scout <span class="text-nesta-aqua">Pro</span></h1>
                </div>
            </div>
            <div class="flex gap-4">
                <button onclick="openUserGuide()" class="btn-interactive px-4 py-2 text-sm font-bold text-nesta-navy bg-white border border-white/20 hover:bg-nesta-aqua hover:text-nesta-navy rounded-sm shadow-lg">
                    User Guide
                </button>
                <button onclick="downloadCSV()" class="btn-interactive px-4 py-2 text-sm font-bold text-white hover:text-nesta-aqua flex items-center gap-2 group border border-transparent hover:border-white/10 rounded">
                    <svg class="w-4 h-4 group-hover:-translate-y-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    Export
                </button>
                <button onclick="generateBriefing()" class="btn-interactive px-4 py-2 text-sm font-bold text-white hover:text-nesta-aqua flex items-center gap-2 group border border-transparent hover:border-white/10 rounded">
                    üìÑ Briefing PDF
                </button>
                <button onclick="openSavedSignals()" class="btn-interactive px-6 py-2 bg-white text-nesta-navy text-sm font-bold rounded-sm hover:bg-nesta-aqua hover:text-nesta-navy shadow-lg">
                    Full Database
                </button>
            </div>
        </div>
        <div class="h-1.5 w-full bg-gradient-to-r from-nesta-blue via-nesta-purple to-nesta-orange"></div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto w-full px-6 py-10 space-y-10">
        
        <div class="bg-white rounded-xl shadow-soft p-10 space-y-10 relative overflow-hidden border border-gray-100">
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-end">
                <div class="md:col-span-4 space-y-3">
                    <label for="mission-select" class="text-xs font-bold text-nesta-darkgrey uppercase tracking-widest pl-1">Nesta Mission</label>
                    <div class="relative group transition-all duration-300 ease-out hover:-translate-y-1 bg-white rounded-2xl">
                        <select id="mission-select" name="mission" class="w-full appearance-none bg-transparent border-2 border-gray-100 text-nesta-navy font-bold text-lg py-4 px-6 rounded-2xl focus:outline-none focus:border-nesta-blue focus:ring-4 focus:ring-nesta-blue/5 cursor-pointer hover:border-nesta-blue/30 transition-all duration-300 shadow-soft hover:shadow-hover z-10 relative">
                            <option class="text-nesta-navy" value="All Missions">All Missions</option>
                            <option class="text-nesta-navy" value="A Fairer Start">A Fairer Start üìö</option>
                            <option class="text-nesta-navy" value="A Healthy Life">A Healthy Life ‚ù§Ô∏è‚Äçü©π</option>
                            <option class="text-nesta-navy" value="A Sustainable Future">A Sustainable Future üå≥</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-6 pointer-events-none text-nesta-navy group-hover:text-nesta-blue transition-colors duration-300 z-0">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-8 space-y-3">
                    <label class="text-xs font-bold text-nesta-darkgrey uppercase tracking-widest pl-1">Scan Mode</span>
                    <div class="flex flex-wrap gap-3">
                        <label class="tooltip flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-full text-xs font-bold text-nesta-navy bg-white shadow-sm cursor-pointer hover:border-nesta-blue/40 transition" data-tooltip="Mainstream tech journalism and industry reports.">
                            <input type="radio" name="scan_mode" value="general" class="text-nesta-blue focus:ring-nesta-blue" checked>
                            üì∞ News
                        </label>
                        <label class="tooltip flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-full text-xs font-bold text-nesta-navy bg-white shadow-sm cursor-pointer hover:border-nesta-blue/40 transition" data-tooltip="Policy trackers, government reports, and official releases.">
                            <input type="radio" name="scan_mode" value="policy" class="text-nesta-blue focus:ring-nesta-blue">
                            üèõÔ∏è Policy
                        </label>
                        <label class="tooltip flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-full text-xs font-bold text-nesta-navy bg-white shadow-sm cursor-pointer hover:border-nesta-blue/40 transition" data-tooltip="Grant programmes, funding calls, and research awards.">
                            <input type="radio" name="scan_mode" value="grants" class="text-nesta-blue focus:ring-nesta-blue">
                            üí∞ Grants
                        </label>
                        <label class="tooltip flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-full text-xs font-bold text-nesta-navy bg-white shadow-sm cursor-pointer hover:border-nesta-blue/40 transition" data-tooltip="Grassroots insights, forums, and community narratives.">
                            <input type="radio" name="scan_mode" value="community" class="text-nesta-blue focus:ring-nesta-blue">
                            üó£Ô∏è Community
                        </label>
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
                <div class="lg:col-span-4 space-y-4">
                    <div class="space-y-2">
                        <label for="topic-input" class="text-xs font-bold text-nesta-darkgrey uppercase tracking-widest">Focus Topic (Optional)</label>
                        <div class="relative group transition-all duration-300 ease-out hover:-translate-y-1">
                            <input type="text" id="topic-input" name="topic"
                                class="w-full text-lg font-display text-nesta-navy placeholder-gray-300 border-2 border-gray-100 rounded-2xl py-5 px-6 shadow-soft focus:outline-none focus:border-nesta-blue focus:ring-4 focus:ring-nesta-blue/5 transition-all duration-300 bg-white hover:shadow-hover hover:border-nesta-blue/30 focus:scale-[1.01]"
                                placeholder="e.g. 'Generative AI' ‚Äî or leave empty for Broad Scan"
                                onkeypress="handleEnter(event)"
                                oninput="toggleButtonState()">
                            <button type="button" onclick="generateFrictionQuery()" title="Generate Friction Query"
                                class="absolute right-16 top-1/2 -translate-y-1/2 text-nesta-navy/70 hover:text-nesta-blue text-xl transition-transform duration-200 ease-out hover:scale-110">
                                üé≤
                            </button>
                            <div class="absolute right-6 top-1/2 -translate-y-1/2 text-nesta-blue transition-all duration-500 ease-out group-focus-within:scale-110 group-focus-within:rotate-12 group-focus-within:text-nesta-aqua">
                                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <div class="flex justify-between items-baseline px-1">
                            <label for="signal-count" class="text-xs font-bold text-nesta-darkgrey uppercase tracking-widest">Quantity</label>
                            <span id="count-display" class="text-xs font-bold text-nesta-navy bg-nesta-aqua/20 px-3 py-1 rounded-full">3 Signals</span>
                        </div>
                        <input type="range" id="signal-count" name="count" min="1" max="5" value="3" 
                               oninput="document.getElementById('count-display').innerText = this.value + ' Signals'"
                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-nesta-blue">
                    </div>
                </div>

                <div class="lg:col-span-8 space-y-3">
                    <label class="text-xs font-bold text-nesta-darkgrey uppercase tracking-widest">SOURCE FILTERS (Multi-Select)</span>
                    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3" id="source-bias-container">
                        <div class="bias-chip relative">
                            <input type="checkbox" id="bias-policy" name="source_bias" value="Policy" class="peer sr-only">
                            <label for="bias-policy" class="tooltip px-4 py-3 border border-nesta-sand rounded-lg text-xs font-bold text-nesta-darkgrey cursor-pointer block" data-tooltip="Government portals, parliamentary sources, and policy documents.">üèõÔ∏è Gov & Policy Sites</label>
                        </div>
                        <div class="bias-chip relative">
                            <input type="checkbox" id="bias-grants" name="source_bias" value="Grants" class="peer sr-only">
                            <label for="bias-grants" class="tooltip px-4 py-3 border border-nesta-sand rounded-lg text-xs font-bold text-nesta-darkgrey cursor-pointer block" data-tooltip="Grant programmes, funding calls, and research awards.">üí∞ Funding Bodies</label>
                        </div>
                        <div class="bias-chip relative">
                            <input type="checkbox" id="bias-academia" name="source_bias" value="Academia" class="peer sr-only">
                            <label for="bias-academia" class="tooltip px-4 py-3 border border-nesta-sand rounded-lg text-xs font-bold text-nesta-darkgrey cursor-pointer block" data-tooltip="Scientific papers, journals, and university research.">üß™ Academia</label>
                        </div>
                        <div class="bias-chip relative">
                            <input type="checkbox" id="bias-emerging" name="source_bias" value="Emerging Tech" class="peer sr-only">
                            <label for="bias-emerging" class="tooltip px-4 py-3 border border-nesta-sand rounded-lg text-xs font-bold text-nesta-darkgrey cursor-pointer block" data-tooltip="Broad landscape of innovation, including software, AI, and apps.">üöÄ Emerging Tech</label>
                        </div>
                        <div class="bias-chip relative">
                            <input type="checkbox" id="bias-data" name="source_bias" value="Open Data" class="peer sr-only">
                            <label for="bias-data" class="tooltip px-4 py-3 border border-nesta-sand rounded-lg text-xs font-bold text-nesta-darkgrey cursor-pointer block" data-tooltip="Open datasets, dashboards, and public data portals.">üìä Open Data</label>
                        </div>
                        <div class="bias-chip relative">
                            <input type="checkbox" id="bias-niche" name="source_bias" value="Niche Forums" class="peer sr-only">
                            <label for="bias-niche" class="tooltip px-4 py-3 border border-nesta-sand rounded-lg text-xs font-bold text-nesta-darkgrey cursor-pointer block" data-tooltip="Specialist forums and expert community spaces.">üó£Ô∏è Niche Forums</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6 pt-2 border-t border-gray-100">
                <div class="flex flex-wrap gap-4">
                    <div class="tooltip flex items-center gap-3 bg-gray-50 px-5 py-3 border border-nesta-sand rounded-lg cursor-pointer hover:border-nesta-orange/50 transition shadow-sm tech-toggle-group" data-tooltip="Tangible engineering and scientific breakthroughs.">
                        <input type="checkbox" id="tech-mode" name="tech_mode" class="w-5 h-5 text-nesta-orange border-gray-300 rounded focus:ring-nesta-orange bg-white checked:bg-nesta-orange checked:border-transparent cursor-pointer">
                        <label for="tech-mode" class="text-sm font-bold text-nesta-navy cursor-pointer select-none tech-toggle-label">Deep Tech</label>
                    </div>

                    <div class="flex bg-gray-100 p-1 rounded-lg">
                        <button onclick="switchView('list')" id="btn-list" class="px-5 py-2 text-xs font-bold transition shadow-sm bg-nesta-navy text-white rounded-md hover:scale-105 active:scale-95">List</button>
                        <button onclick="switchView('radar')" id="btn-radar" class="px-5 py-2 text-xs font-bold transition text-nesta-darkgrey hover:text-nesta-navy rounded-md hover:scale-105 active:scale-95">Radar</button>
                        <button onclick="switchView('network')" id="btn-network" class="px-5 py-2 text-xs font-bold transition text-nesta-darkgrey hover:text-nesta-navy rounded-md hover:scale-105 active:scale-95">Network</button>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4 items-center">
                    <div class="bg-gray-50 border border-gray-200 rounded-full px-4 py-2 flex items-center gap-3">
                        <label for="time-filter" class="text-xs font-bold text-nesta-darkgrey uppercase tracking-widest">Time Horizon</label>
                        <div class="relative group">
                            <select id="time-filter" name="time_filter" class="appearance-none bg-transparent border-none focus:ring-0 cursor-pointer text-nesta-navy font-bold text-sm pr-6">
                                <option value="w1" class="bg-white text-nesta-navy">Past 7 Days</option>
                                <option value="m1" selected class="bg-white text-nesta-navy">Past Month</option>
                                <option value="m3" class="bg-white text-nesta-navy">Past 3 Months</option>
                                <option value="m6" class="bg-white text-nesta-navy">Past 6 Months</option>
                                <option value="y1" class="bg-white text-nesta-navy">Past Year</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pointer-events-none text-nesta-navy group-hover:text-nesta-blue transition-colors">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </div>
                    </div>

                    <div class="h-8 w-px bg-gray-200 mx-2 hidden lg:block"></div>

                    <button onclick="generateSignal(true)" id="broad-btn" class="btn-interactive px-6 py-3 text-sm font-bold text-nesta-darkgrey hover:text-nesta-blue hover:bg-gray-50 rounded border border-transparent hover:border-nesta-blue/20">Broad Scan</button>
                    
                    <button id="search-btn" onclick="generateSignal(false)" class="hidden btn-interactive px-8 py-3 bg-nesta-blue text-white text-sm font-bold rounded shadow-lg hover:bg-blue-700 hover:shadow-xl flex items-center gap-3">
                        <span>Initiate Scan</span>
                    </button>
                    
                    <button id="stop-btn" onclick="stopScan()" class="hidden btn-interactive px-8 py-3 bg-nesta-red text-white text-sm font-bold rounded shadow-lg hover:bg-red-700 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        Stop
                    </button>

                    <button id="download-signals-btn" onclick="downloadSignalsAsCSV()" class="hidden btn-interactive px-6 py-3 text-sm font-bold bg-nesta-black text-white hover:bg-opacity-90 transition-all rounded-full">
                        Download CSV
                    </button>
                </div>
            </div>

            <div class="mt-6 border border-nesta-black rounded-lg overflow-hidden">
                <div id="terminal-header" onclick="toggleTerminal()" class="bg-nesta-black text-white p-2 flex justify-between items-center cursor-pointer text-xs font-bold uppercase tracking-widest">
                    <span class="text-nesta-green">&gt;_ SYSTEM LOGS</span>
                    <span id="terminal-toggle-indicator">[+]</span>
                </div>
                <div id="live-terminal" class="hidden bg-nesta-sand text-nesta-black text-xs font-body p-4 h-32 overflow-y-auto border-t border-nesta-black"></div>
            </div>
        </div>

        <div id="view-controls" class="flex justify-between items-center px-2">
            <div>
                <button onclick="synthesizeTrend()" class="btn-interactive px-5 py-2 text-xs font-bold bg-nesta-purple text-white rounded-full shadow-sm hover:bg-nesta-blue transition">
                    ‚ú® Synthesise
                </button>
            </div>
            <div class="flex gap-2 bg-white p-1.5 rounded-full shadow-sm border border-gray-100">
                <button onclick="switchFilter('scan')" id="filter-btn-scan" class="filter-view-btn active px-4 py-1.5 rounded-full text-xs font-bold border border-nesta-navy text-nesta-navy hover:bg-gray-100">Current Scan</button>
                <div class="h-6 w-px bg-gray-200 mx-1"></div>
                <button onclick="switchFilter('recent')" id="filter-btn-recent" class="filter-view-btn px-4 py-1.5 rounded-full text-xs font-bold border border-transparent text-gray-500 hover:bg-gray-50 hover:text-nesta-navy">Recent DB</button>
                <button onclick="switchFilter('funding')" id="filter-btn-funding" class="filter-view-btn px-4 py-1.5 rounded-full text-xs font-bold border border-transparent text-gray-500 hover:bg-gray-50 hover:text-nesta-navy">Funding</button>
                <button onclick="switchFilter('tech')" id="filter-btn-tech" class="filter-view-btn px-4 py-1.5 rounded-full text-xs font-bold border border-transparent text-gray-500 hover:bg-gray-50 hover:text-nesta-navy">Emerging Tech</button>
            </div>
        </div>

        <div id="result-container" class="grid grid-cols-1 gap-8"></div>
        
        <div id="radar-container" class="hidden bg-white p-10 shadow-soft border border-gray-100 min-h-[600px] flex flex-col items-center justify-center rounded-xl relative">
            <div class="w-full h-[500px] relative"><canvas id="signalRadar"></canvas></div>
        </div>

        <div id="network-container" class="hidden bg-white p-6 shadow-soft border border-gray-100 h-[600px] rounded-xl relative">
            <div id="signalNetwork" class="w-full h-full"></div>
        </div>

        <section id="preview-section" class="pt-12 border-t border-gray-200">
            <div class="flex justify-between items-end mb-8">
                <div>
                </div>
                <button onclick="openSavedSignals()" class="text-sm font-bold text-nesta-blue hover:text-nesta-navy transition flex items-center gap-1 group">
                    View All <span class="group-hover:translate-x-1 transition-transform">‚Üí</span>
                </button>
            </div>
            
            <div id="preview-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8 opacity-100">
                <div class="h-64 bg-white rounded-xl border border-gray-100 shadow-sm p-6 space-y-4 animate-pulse">
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-nesta-navy text-white mt-auto">
        <div class="h-1 w-full bg-gradient-to-r from-nesta-blue via-nesta-purple to-nesta-orange"></div>
        <div class="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="w-6 h-6 bg-white text-nesta-navy flex items-center justify-center text-sm font-bold rounded-sm brand-font">N</div>
                <div class="flex flex-col">
                    <span class="text-sm font-display leading-none">Nesta Discovery Hub</span>
                </div>
            </div>
            <div class="text-[10px] font-body opacity-50 tracking-wide">
                &copy; 2025 NESTA. ALL RIGHTS RESERVED.
            </div>
        </div>
    </footer>

    <div id="saved-modal" class="fixed inset-0 bg-nesta-navy/90 backdrop-blur-md z-[100] hidden flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-7xl h-[85vh] shadow-2xl flex flex-col overflow-hidden rounded-2xl animate-fade-in-up">
            <div class="px-10 py-6 border-b border-gray-100 flex justify-between items-center bg-white sticky top-0 z-10">
                <div>
                    <h2 class="text-3xl brand-font text-nesta-navy">Signal Database</h2>
                </div>
                <button onclick="closeSavedSignals()" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 transition rounded-full text-nesta-navy font-bold text-xl">‚úï</button>
            </div>
            <div id="saved-list" class="flex-1 overflow-y-auto p-10 bg-gray-50 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        </div>
    </div>

    <div id="user-guide-modal" class="fixed inset-0 bg-nesta-navy/90 backdrop-blur-md z-[110] hidden flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-4xl h-[85vh] shadow-2xl flex flex-col overflow-hidden rounded-2xl animate-fade-in-up font-body">
            <div class="px-10 py-6 border-b border-gray-100 flex justify-between items-center bg-white sticky top-0 z-10">
                <div>
                    <h2 class="text-3xl brand-font text-nesta-navy">Signal Scout: User Guide</h2>
                </div>
                <button onclick="closeUserGuide()" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 transition rounded-full text-nesta-navy font-bold text-xl">‚úï</button>
            </div>
            <div class="flex-1 overflow-y-auto p-10 space-y-12 text-nesta-navy font-body">
                
                <div class="text-center space-y-4 border-b border-gray-100 pb-10">
                    <div class="w-16 h-16 bg-nesta-blue text-white rounded-2xl flex items-center justify-center text-3xl font-bold mx-auto shadow-lg mb-4 brand-font">N</div>
                    <h3 class="text-4xl brand-font text-nesta-navy">Welcome to Signal Scout</h3>
                    <p class="text-lg max-w-2xl mx-auto text-gray-500">Your autonomous AI agent for discovering weak signals, emerging trends, and hidden innovations.</p>
                </div>

                <section>
                    <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6 border-b border-gray-100 pb-2">How It Works</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 hover:shadow-md transition-shadow">
                            <div class="text-4xl mb-4">üîç</div>
                            <h5 class="font-bold text-nesta-navy text-lg mb-2">1. Scan</h5>
                            <p class="text-sm text-gray-600 leading-relaxed">The agent generates "High Entropy" queries (e.g. <em>"biotech + unregulated"</em>) to bypass mainstream news and find hidden gems.</p>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 hover:shadow-md transition-shadow">
                            <div class="text-4xl mb-4">üß†</div>
                            <h5 class="font-bold text-nesta-navy text-lg mb-2">2. Analyse</h5>
                            <p class="text-sm text-gray-600 leading-relaxed">It reads articles in real-time, verifying facts and scoring them on Novelty, Evidence, and Impact.</p>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-100 hover:shadow-md transition-shadow">
                            <div class="text-4xl mb-4">üíé</div>
                            <h5 class="font-bold text-nesta-navy text-lg mb-2">3. Synthesise</h5>
                            <p class="text-sm text-gray-600 leading-relaxed">It produces a concise "Signal Card" with a strategic hook, ready for your research database.</p>
                        </div>
                    </div>
                </section>

                <section>
                    <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6 border-b border-gray-100 pb-2">Interface Guide</h4>
                    <div class="space-y-8">
                        
                        <div class="flex flex-col sm:flex-row items-start gap-6">
                            <div class="shrink-0 w-16 flex justify-center pt-2">
                                <span class="text-2xl shadow-sm border border-gray-200 rounded-lg p-2 bg-white">üé≤</span>
                            </div>
                            <div>
                                <h5 class="font-bold text-nesta-navy text-lg">The "Inspire Me" Button</h5>
                                <p class="text-sm text-gray-600 mt-1 max-w-xl">Stuck for ideas? Click the dice to instantly generate a <strong>"Friction Query"</strong>. This creates random collisions (e.g. <em>"heat pumps + lawsuit"</em>) that often lead to the most surprising discoveries.</p>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row items-start gap-6">
                            <div class="shrink-0 w-16 flex justify-center pt-2">
                                <div class="scale-75 origin-top">
                                    <div class="flex items-center gap-2 bg-gray-50 px-3 py-2 border border-nesta-sand rounded-lg shadow-sm w-max">
                                        <input type="checkbox" checked class="text-nesta-orange rounded focus:ring-0 cursor-default" onclick="return false;">
                                        <span class="text-xs font-bold text-nesta-navy">Deep Tech</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-bold text-nesta-navy text-lg">Deep Tech Mode</h5>
                                <p class="text-sm text-gray-600 mt-1 max-w-xl">Restricts results to <strong>"Atoms"</strong> (Hardware, Biotech, Energy, Materials). Use this when you want to filter out software apps and focus on tangible engineering breakthroughs.</p>
                            </div>
                        </div>

                        <div class="flex flex-col sm:flex-row items-start gap-6">
                            <div class="shrink-0 w-16 flex justify-center gap-1 pt-2">
                                <span class="w-2 h-2 rounded-full bg-nesta-red"></span>
                                <span class="w-2 h-2 rounded-full bg-nesta-blue"></span>
                                <span class="w-2 h-2 rounded-full bg-nesta-green"></span>
                            </div>
                            <div>
                                <h5 class="font-bold text-nesta-navy text-lg">Signal Actions</h5>
                                <ul class="text-sm text-gray-600 mt-2 space-y-1 list-disc pl-4">
                                    <li><strong>Reject:</strong> Discards the signal (helps train the filter).</li>
                                    <li><strong>Copy:</strong> Copies a formatted summary to your clipboard for Slack/Teams.</li>
                                    <li><strong>Star:</strong> Saves the signal to the "Shortlist" in the permanent database.</li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </section>

                <section class="bg-nesta-navy text-white p-10 rounded-2xl shadow-soft">
                    <h4 class="text-xs font-bold uppercase tracking-widest text-nesta-aqua mb-8 border-b border-white/10 pb-4">The Scoring Framework</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center divide-y md:divide-y-0 md:divide-x divide-white/10">
                        <div class="pt-4 md:pt-0">
                            <div class="text-5xl font-bold brand-font text-nesta-yellow mb-3">0-10</div>
                            <div class="font-bold text-sm uppercase tracking-widest mb-3">Novelty</div>
                            <p class="text-sm opacity-70 px-4">"Distance from Mainstream"<br><br>High score = Obscure academic paper or niche forum.<br>Low score = BBC News or TechCrunch.</p>
                        </div>
                        <div class="pt-8 md:pt-0 md:pl-8">
                            <div class="text-5xl font-bold brand-font text-nesta-pink mb-3">0-10</div>
                            <div class="font-bold text-sm uppercase tracking-widest mb-3">Evidence</div>
                            <p class="text-sm opacity-70 px-4">"Reality Factor"<br><br>High score = A launched pilot, a passed law, or published data.<br>Low score = A "concept" or "vision".</p>
                        </div>
                        <div class="pt-8 md:pt-0 md:pl-8">
                            <div class="text-5xl font-bold brand-font text-nesta-aqua mb-3">0-10</div>
                            <div class="font-bold text-sm uppercase tracking-widest mb-3">Impact</div>
                            <p class="text-sm opacity-70 px-4">"The What!? Factor"<br><br>High score = Fundamentally changes a system or behaviour.<br>Low score = Incremental improvement.</p>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-8 right-8 bg-nesta-navy text-white px-6 py-4 shadow-2xl transform translate-y-24 opacity-0 transition-all duration-500 z-[120] font-bold text-sm flex items-center gap-4 rounded-lg border-l-4 border-nesta-aqua">
        <div class="w-2 h-2 rounded-full bg-nesta-aqua shrink-0"></div><span id="toast-msg">Action Successful</span>
    </div>

    <script src="friction-config.js"></script>
    <script type="module" src="./static/js/app.js"></script>
</body>
</html>
